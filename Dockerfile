FROM debian:jessie

LABEL author="Emre Bastuz (info@hml.io)"
LABEL maintainer="cved (cved@protonmail.com)"

ENV LANG C.UTF-8
ENV LANGUAGE C.UTF-8
ENV LC_ALL C.UTF-8

ARG DEBIAN_FRONTEND=noninteractive
RUN apt-get -y update \
    && apt-get -y install \
    wget \
    apache2 \
    && apt-get autoremove \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

RUN wget http://snapshot.debian.org/archive/debian/20130319T033933Z/pool/main/o/openssl/openssl_1.0.1e-2_amd64.deb -O /tmp/openssl_1.0.1e-2_amd64.deb \
    && dpkg -i /tmp/openssl_1.0.1e-2_amd64.deb \
    && wget http://snapshot.debian.org/archive/debian/20130319T033933Z/pool/main/o/openssl/libssl1.0.0_1.0.1e-2_amd64.deb -O /tmp/libssl1.0.0_1.0.1e-2_amd64.deb \
    && dpkg -i /tmp/libssl1.0.0_1.0.1e-2_amd64.deb \
    && rm /tmp/*.deb

COPY build/index.html /var/www/

RUN sed -i 's/^NameVirtualHost/#NameVirtualHost/g' /etc/apache2/ports.conf \
    && sed -i 's/^Listen/#Listen/g' /etc/apache2/ports.conf \
    && a2enmod ssl \
    && a2dissite \
    && a2ensite default-ssl

EXPOSE 443

CMD ["/usr/sbin/apache2ctl", "-DFOREGROUND"]
